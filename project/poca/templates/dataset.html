{% extends "base.html" %}


{% block pageheading %}
Data.gov.uk
{% endblock %}

{% block optional_head %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/jquery.dataTables.min.css')}}">
<script src="{{ url_for('static', filename='javascripts/vendor/jquery.dataTables.min.js')}}" type="text/javascript"></script>

{% endblock %}

{% block content %}

<h1 class="heading-xlarge" style='margin-bottom:0;'>
    {{dataset.title}}

    <span style='float:right; color: #dedede;'>
          {{ publisher.title }}
    </span>
</h1>

<hr/>
Prelude
<hr/>

<div id="tabs-container">
    <ul class="tabs-menu">
        <li class="active-tab">
            <i class="fa fa-list">
              <span class="visuallyhidden">Data</span>
            </i>

          <a href="#listview">
            Data
          </a>
        </li>
        {% if _has_geo %}
        <li>
              <i class="fa fa-map-marker">
                  <span class="visuallyhidden">Map</span>
               </i>

            <a href="#mapview">
              Map</a>
        </li>
        {% endif %}
    </ul>
    <div class="clearfix"></div>

    <div class="tab grid-row">
        <div id="listview" class="tab-content" style="display:block; ">
            <div class="grid-row">
                <div class="column-one-quarter">
                    Facets
                </div>

                <div class="column-three-quarter" style="min-height: 500px;">
                    <table id="datatable" class="display" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    {% for col in _columns %}
                                    <th>{{col}}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    {% for col in _columns %}
                                    <th>{{col}}</th>
                                    {% endfor %}
                                </tr>
                            </tfoot>
                        </table>

                </div>
            </div>
        </div>

        {% if _has_geo %}
        <div id="mapview" class="tab-content" style="display:block; display:none;">
            <div class="grid-row">
                <div class="column-one-quarter">
                    Facets
                </div>

                <div class="column-three-quarter">
                     <div id="map" class="map" style="width: 100%; height: 600px;">
                      <div id="popup" class="ol-popup">
                        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                        <div id="popup-content"></div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>



<script>
    var map;
    var map_loaded = false;

    (function($) {
        $(".tabs-menu a").click(function(event) {
            event.preventDefault();
            $(this).parent().addClass("active-tab");
            $(this).parent().siblings().removeClass("active-tab");
            var tab = $(this).attr("href");
            $(".tab-content").not(tab).css("display", "none");
            $(tab).show();
            // We don't want to keep focus because 'yellow box'.
            $(this).blur();
            {% if _has_geo %}
            if (event.target.hash == "#mapview" && !map_loaded) {
              setup_map();
            }
            {% endif %}
        });

    function setup_map(){
        map = new ol.Map({
            target: 'map',
            layers: [
              new ol.layer.Tile({
                  source: new ol.source.OSM()
              })
            ],
            view: new ol.View({
                center: new ol.proj.transform([-3.5360, 54.5781], 'EPSG:4326', 'EPSG:3857'),
                zoom: 5.8
            })
        });
        map_loaded = true;
    }


$('#datatable').DataTable( {
    serverSide: true,
    processing: true,
    columns: [
        {% for col in _columns %}
            { "data": "{{col}}" }
            {% if not loop.last %}, {% endif%}
        {% endfor %}
    ],
    ajax: {
        url: '/dataset/carparks/data',
    }
} );

    })(jQuery);


    </script>

{% endblock %}